document.addEventListener('DOMContentLoaded', function () {
  var calendarEl = document.getElementById('calendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'listYear',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'listYear,listMonth,listWeek'
    },
    locale: 'de',
    firstDay: 1,
    events: 'events.json',
    validRange: {
      start: '2025-08-01',
      end: '2026-07-31'
    },
    listDayFormat: { day: '2-digit', month: '2-digit', year: '2-digit' },
    eventTimeFormat: { hour: '2-digit', minute: '2-digit', hour12: false },

    eventClick: function (info) {
      if (info.event.extendedProps.link) {
        window.open(info.event.extendedProps.link, '_blank');
      } else {
        alert(
          info.event.title + '\n' +
          (info.event.extendedProps.description || '') + '\n' +
          'Hallen-Code: ' + (info.event.extendedProps.location || 'keine Angabe') + '\n' +
          'Beginn: ' + info.event.start.toLocaleString()
        );
      }
    },

    eventDidMount: function (info) {
      let tooltipContent = info.event.title;
      if (info.event.extendedProps.description) {
        tooltipContent += '\n' + info.event.extendedProps.description;
      }
      if (info.event.extendedProps.image) {
        tooltipContent += '\n\n(Bild vorhanden – Klick für Spielbericht)';
      }
      if (!('ontouchstart' in window)) {
        new bootstrap.Tooltip(info.el, {
          title: tooltipContent,
          placement: 'top',
          trigger: 'hover',
          container: 'body'
        });
      }
    }
  });

  calendar.render();
});
